<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanceApp - Controle Financeiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .skeleton {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { background-color: #e5e7eb; }
            50% { background-color: #f3f4f6; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .icon {
            font-size: 1.25rem; /* Ajuste o tamanho do √≠cone */
            line-height: 1;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 font-sans min-h-screen">

    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
            <h1 class="text-3xl font-bold">Dashboard Financeiro</h1>
            <div class="text-center md:text-right">
                <span class="text-lg font-medium text-gray-600">Saldo Atual</span>
                <p class="text-2xl font-bold text-green-600 mt-1" id="saldo-atual">R$ 0,00</p>
            </div>
        </header>

        <div id="loading-state" class="space-y-4">
            <div class="h-8 bg-gray-300 rounded-md w-3/4 skeleton"></div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="h-28 bg-gray-300 rounded-xl skeleton"></div>
                <div class="h-28 bg-gray-300 rounded-xl skeleton"></div>
                <div class="h-28 bg-gray-300 rounded-xl skeleton"></div>
            </div>
            <div class="h-64 bg-gray-300 rounded-xl skeleton"></div>
        </div>

        <div id="main-content" class="hidden space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div class="bg-white p-6 rounded-xl shadow-md fade-in">
                    <p class="text-gray-500 text-sm">Receitas</p>
                    <p class="text-2xl font-bold text-green-600" id="receitas">R$ 0,00</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md fade-in">
                    <p class="text-gray-500 text-sm">Despesas</p>
                    <p class="text-2xl font-bold text-red-600" id="despesas">R$ 0,00</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md fade-in">
                    <p class="text-gray-500 text-sm">Contas a Pagar</p>
                    <p class="text-2xl font-bold text-yellow-600" id="contas-pagar">0</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-md fade-in">
                    <h2 class="text-xl font-semibold mb-4">Saldo ao Longo do Tempo</h2>
                    <div class="h-64">
                        <canvas id="grafico-saldo"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md fade-in">
                    <h2 class="text-xl font-semibold mb-4">Despesas por Categoria</h2>
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div class="w-full md:w-1/2 h-64">
                            <canvas id="grafico-categorias"></canvas>
                        </div>
                        <div class="w-full md:w-1/2 mt-4 md:mt-0 md:pl-4">
                            <div id="legenda-categorias" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md fade-in">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-2">
                    <h2 class="text-xl font-semibold">Contas a Pagar</h2>
                    <div class="flex gap-2">
                        <select id="filtro-status" class="border rounded-md p-2 text-sm">
                            <option value="todos">Todos</option>
                            <option value="pendente">Pendentes</option>
                            <option value="vencida">Vencidas</option>
                            <option value="paga">Pagas</option>
                        </select>
                        <button id="btn-adicionar-conta" class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 transition-colors flex items-center gap-1">
                            <span class="icon">+</span> Adicionar Conta
                        </button>
                    </div>
                </div>
                <ul id="lista-contas" class="space-y-4"></ul>
            </div>
        </div>

        <div id="modal-conta" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
            <div class="bg-white rounded-xl shadow-lg w-full max-w-md slide-in">
                <div class="p-6">
                    <h3 class="text-xl font-semibold mb-4">Adicionar Nova Conta</h3>
                    <form id="form-conta" class="space-y-4">
                        <div>
                            <label for="nome-conta" class="block text-sm font-medium text-gray-700 mb-1">Nome da Conta</label>
                            <input type="text" id="nome-conta" class="w-full border rounded-md p-2" required>
                        </div>
                        <div>
                            <label for="valor-conta" class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                            <input type="number" id="valor-conta" step="0.01" min="0" class="w-full border rounded-md p-2" required>
                        </div>
                        <div>
                            <label for="categoria-conta" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                            <select id="categoria-conta" class="w-full border rounded-md p-2" required>
                                <option value="">Selecione uma categoria</option>
                                <option value="Moradia">Moradia</option>
                                <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                                <option value="Transporte">Transporte</option>
                                <option value="Sa√∫de">Sa√∫de</option>
                                <option value="Educa√ß√£o">Educa√ß√£o</option>
                                <option value="Lazer">Lazer</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div>
                            <label for="vencimento-conta" class="block text-sm font-medium text-gray-700 mb-1">Data de Vencimento</label>
                            <input type="date" id="vencimento-conta" class="w-full border rounded-md p-2" required>
                        </div>
                        <div class="flex justify-end gap-2 pt-4">
                            <button type="button" id="btn-cancelar" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Cancelar</button>
                            <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Salvar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mapeamento de categorias para √≠cones
        const iconesCategorias = {
            'Moradia': 'üè†',
            'Alimenta√ß√£o': 'üõí',
            'Transporte': 'üöó',
            'Sa√∫de': 'üíä',
            'Educa√ß√£o': 'üìö',
            'Lazer': 'üé¨',
            'Outros': 'üì¶'
        };

        // Dados iniciais ou carregados do localStorage
        let dadosFinanceiros = JSON.parse(localStorage.getItem('dadosFinanceiros')) || {
            saldo: 1547.50,
            receitas: 3200.00,
            despesas: 1652.50,
            contas: [
                { id: 1, nome: 'Aluguel', valor: 950.00, categoria: 'Moradia', vencimento: '2025-09-25', status: 'pendente' },
                { id: 2, nome: 'Conta de Luz', valor: 125.75, categoria: 'Moradia', vencimento: '2025-09-20', status: 'vencida' },
                { id: 3, nome: 'Assinatura Spotify', valor: 21.90, categoria: 'Lazer', vencimento: '2025-10-01', status: 'pendente' },
                { id: 4, nome: 'Supermercado', valor: 350.00, categoria: 'Alimenta√ß√£o', vencimento: '2025-09-22', status: 'paga' },
                { id: 5, nome: 'Academia', valor: 89.90, categoria: 'Sa√∫de', vencimento: '2025-09-28', status: 'pendente' },
                { id: 6, nome: 'Combust√≠vel', valor: 150.00, categoria: 'Transporte', vencimento: '2025-09-18', status: 'paga' },
                { id: 7, nome: 'Cinema', valor: 80.00, categoria: 'Lazer', vencimento: '2025-09-15', status: 'paga' },
                { id: 8, nome: 'Internet', valor: 100.00, categoria: 'Moradia', vencimento: '2025-10-10', status: 'pendente' },
            ]
        };

        // Refer√™ncias aos elementos HTML
        const loadingState = document.getElementById('loading-state');
        const mainContent = document.getElementById('main-content');
        const saldoAtualEl = document.getElementById('saldo-atual');
        const receitasEl = document.getElementById('receitas');
        const despesasEl = document.getElementById('despesas');
        const contasPagarEl = document.getElementById('contas-pagar');
        const listaContasEl = document.getElementById('lista-contas');
        const filtroStatus = document.getElementById('filtro-status');
        const btnAdicionarConta = document.getElementById('btn-adicionar-conta');
        const modalConta = document.getElementById('modal-conta');
        const formConta = document.getElementById('form-conta');
        const btnCancelar = document.getElementById('btn-cancelar');
        const nomeContaInput = document.getElementById('nome-conta');
        const valorContaInput = document.getElementById('valor-conta');
        const vencimentoContaInput = document.getElementById('vencimento-conta');

        // Gr√°ficos
        let graficoCategorias;
        let graficoSaldo;

        // Fun√ß√£o para formatar valores como moeda
        const formatarMoeda = (valor) => `R$ ${parseFloat(valor).toFixed(2).replace('.', ',')}`;

        // Fun√ß√£o para formatar data
        const formatarData = (dataString) => {
            const data = new Date(dataString + 'T00:00:00'); // Garante que a data seja interpretada como local para evitar problemas de fuso hor√°rio
            return data.toLocaleDateString('pt-BR');
        };

        // Fun√ß√£o para verificar status da conta
        const verificarStatusConta = (vencimento, statusAtual) => {
            if (statusAtual === 'paga') return 'paga';
            const hoje = new Date();
            const dataVencimento = new Date(vencimento + 'T00:00:00');
            return dataVencimento < hoje ? 'vencida' : 'pendente';
        };

        const salvarDados = () => {
            localStorage.setItem('dadosFinanceiros', JSON.stringify(dadosFinanceiros));
        };

        const calcularTotais = () => {
            atualizarStatusContas();
            const totalDespesas = dadosFinanceiros.contas.filter(c => c.status === 'paga').reduce((total, c) => total + c.valor, 0);
            dadosFinanceiros.despesas = totalDespesas;
            dadosFinanceiros.saldo = dadosFinanceiros.receitas - dadosFinanceiros.despesas;
            const contasPendentes = dadosFinanceiros.contas.filter(c => c.status === 'pendente' || c.status === 'vencida').length;
            saldoAtualEl.textContent = formatarMoeda(dadosFinanceiros.saldo);
            receitasEl.textContent = formatarMoeda(dadosFinanceiros.receitas);
            despesasEl.textContent = formatarMoeda(dadosFinanceiros.despesas);
            contasPagarEl.textContent = contasPendentes;
            salvarDados();
        };

        // Fun√ß√£o para gerar cores para o gr√°fico
        const gerarCores = (quantidade) => {
            const cores = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
            ];
            return cores.slice(0, quantidade);
        };

        // Fun√ß√µes de Gr√°ficos
        const criarGraficoCategorias = () => {
            const ctx = document.getElementById('grafico-categorias').getContext('2d');
            const despesasPorCategoria = {};
            dadosFinanceiros.contas
                .filter(c => c.status === 'paga')
                .forEach(c => {
                    if (despesasPorCategoria[c.categoria]) {
                        despesasPorCategoria[c.categoria] += c.valor;
                    } else {
                        despesasPorCategoria[c.categoria] = c.valor;
                    }
                });
            const categorias = Object.keys(despesasPorCategoria);
            const valores = Object.values(despesasPorCategoria);
            const cores = gerarCores(categorias.length);
            if (graficoCategorias) { graficoCategorias.destroy(); }
            graficoCategorias = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categorias,
                    datasets: [{
                        data: valores,
                        backgroundColor: cores,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => `${c.label}: ${formatarMoeda(c.raw)} (${Math.round((c.raw / valores.reduce((a, b) => a + b, 0)) * 100)}%)` } } }
                }
            });
            const legenda = document.getElementById('legenda-categorias');
            legenda.innerHTML = '';
            categorias.forEach((categoria, index) => {
                const valor = despesasPorCategoria[categoria];
                const porcentagem = Math.round((valor / valores.reduce((a, b) => a + b, 0)) * 100);
                const itemLegenda = document.createElement('div');
                itemLegenda.className = 'flex items-center justify-between';
                itemLegenda.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full mr-2" style="background-color: ${cores[index]}"></div>
                        <span class="text-sm">${categoria}</span>
                    </div>
                    <div class="text-sm font-medium">${formatarMoeda(valor)} (${porcentagem}%)</div>
                `;
                legenda.appendChild(itemLegenda);
            });
        };

        const criarGraficoSaldo = () => {
            const ctx = document.getElementById('grafico-saldo').getContext('2d');
            
            // Dados fict√≠cios para o gr√°fico de saldo ao longo do tempo (√∫ltimos 6 meses)
            const meses = ['Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro'];
            const saldos = [850.00, 1100.50, 925.75, 1450.00, 1280.25, dadosFinanceiros.saldo];
            
            if (graficoSaldo) { graficoSaldo.destroy(); }
            graficoSaldo = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Saldo Mensal',
                        data: saldos,
                        borderColor: '#36A2EB',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (c) => `Saldo: ${formatarMoeda(c.raw)}`
                            }
                        }
                    }
                }
            });
        };

        // Fun√ß√£o para renderizar as contas na lista
        const renderizarContas = (filtro = 'todos') => {
            listaContasEl.innerHTML = '';
            let contasFiltradas = dadosFinanceiros.contas;
            if (filtro !== 'todos') {
                contasFiltradas = dadosFinanceiros.contas.filter(c => c.status === filtro);
            }
            contasFiltradas.sort((a, b) => {
                if (a.status === 'vencida' && b.status !== 'vencida') return -1;
                if (a.status !== 'vencida' && b.status === 'vencida') return 1;
                return new Date(a.vencimento) - new Date(b.vencimento);
            });
            if (contasFiltradas.length === 0) {
                const li = document.createElement('li');
                li.className = 'text-center py-8 text-gray-500';
                li.textContent = 'Nenhuma conta encontrada';
                listaContasEl.appendChild(li);
                return;
            }
            contasFiltradas.forEach(conta => {
                const li = document.createElement('li');
                let classes = 'p-4 rounded-lg shadow-sm flex flex-col sm:flex-row justify-between items-start sm:items-center transition-all duration-200 hover:shadow-md';
                if (conta.status === 'vencida') {
                    classes += ' bg-red-50 border-l-4 border-red-500';
                } else if (conta.status === 'pendente') {
                    classes += ' bg-yellow-50 border-l-4 border-yellow-500';
                } else {
                    classes += ' bg-green-50 border-l-4 border-green-500';
                }
                li.className = classes;
                const iconStatus = conta.status === 'vencida' ? '‚ö†Ô∏è' : conta.status === 'paga' ? '‚úÖ' : '‚û°Ô∏è';
                const iconCategoria = iconesCategorias[conta.categoria] || 'üì¶';
                li.innerHTML = `
                    <div class="flex-1 mb-2 sm:mb-0">
                        <div class="flex items-center mb-1">
                            <span class="text-sm mr-2">${iconStatus}</span>
                            <h3 class="font-semibold text-gray-800">${conta.nome}</h3>
                            <span class="ml-2 text-xs px-2 py-1 rounded-full ${conta.status === 'vencida' ? 'bg-red-100 text-red-800' : conta.status === 'pendente' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">${conta.status}</span>
                        </div>
                        <div class="flex flex-wrap gap-2 text-xs text-gray-500">
                            <span>${iconCategoria} ${conta.categoria}</span>
                            <span>üìÖ Vencimento: ${formatarData(conta.vencimento)}</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-lg font-bold ${conta.status === 'vencida' ? 'text-red-600' : conta.status === 'pendente' ? 'text-yellow-600' : 'text-green-600'}">
                            ${formatarMoeda(conta.valor)}
                        </span>
                        <div class="flex gap-1">
                            <button class="p-1 rounded hover:bg-gray-200 transition-colors" onclick="marcarComoPaga(${conta.id})" title="Marcar como paga">
                                ‚úÖ
                            </button>
                            <button class="p-1 rounded hover:bg-gray-200 transition-colors" onclick="excluirConta(${conta.id})" title="Excluir conta">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
                listaContasEl.appendChild(li);
            });
        };

        const abrirModalConta = () => {
            formConta.reset();
            nomeContaInput.classList.remove('border-red-500');
            valorContaInput.classList.remove('border-red-500');
            vencimentoContaInput.classList.remove('border-red-500');
            modalConta.classList.remove('hidden');
        };

        const fecharModalConta = () => {
            modalConta.classList.add('hidden');
        };

        const adicionarConta = (event) => {
            event.preventDefault();
            
            const nome = nomeContaInput.value.trim();
            const valor = parseFloat(valorContaInput.value);
            const categoria = document.getElementById('categoria-conta').value;
            const vencimento = vencimentoContaInput.value;
            
            let formValido = true;
            if (nome === '') {
                nomeContaInput.classList.add('border-red-500');
                formValido = false;
            } else {
                nomeContaInput.classList.remove('border-red-500');
            }
            if (isNaN(valor) || valor <= 0) {
                valorContaInput.classList.add('border-red-500');
                formValido = false;
            } else {
                valorContaInput.classList.remove('border-red-500');
            }
            if (vencimento === '') {
                vencimentoContaInput.classList.add('border-red-500');
                formValido = false;
            } else {
                vencimentoContaInput.classList.remove('border-red-500');
            }

            if (!formValido) {
                return;
            }
            
            const novaConta = {
                id: Date.now(),
                nome,
                valor,
                categoria,
                vencimento,
                status: verificarStatusConta(vencimento, 'pendente')
            };
            
            dadosFinanceiros.contas.push(novaConta);
            calcularTotais();
            criarGraficoCategorias();
            criarGraficoSaldo();
            renderizarContas(filtroStatus.value);
            fecharModalConta();
        };

        window.marcarComoPaga = (id) => {
            const conta = dadosFinanceiros.contas.find(c => c.id === id);
            if (conta) {
                conta.status = 'paga';
                calcularTotais();
                criarGraficoCategorias();
                criarGraficoSaldo();
                renderizarContas(filtroStatus.value);
            }
        };

        window.excluirConta = (id) => {
            if (confirm('Tem certeza que deseja excluir esta conta?')) {
                dadosFinanceiros.contas = dadosFinanceiros.contas.filter(c => c.id !== id);
                calcularTotais();
                criarGraficoCategorias();
                criarGraficoSaldo();
                renderizarContas(filtroStatus.value);
            }
        };

        const atualizarStatusContas = () => {
            dadosFinanceiros.contas.forEach(conta => {
                conta.status = verificarStatusConta(conta.vencimento, conta.status);
            });
            salvarDados();
        };

        document.addEventListener('DOMContentLoaded', () => {
            btnAdicionarConta.addEventListener('click', abrirModalConta);
            btnCancelar.addEventListener('click', fecharModalConta);
            formConta.addEventListener('submit', adicionarConta);
            filtroStatus.addEventListener('change', () => {
                renderizarContas(filtroStatus.value);
            });
            modalConta.addEventListener('click', (e) => {
                if (e.target === modalConta) {
                    fecharModalConta();
                }
            });
            
            setTimeout(() => {
                loadingState.classList.add('hidden');
                mainContent.classList.remove('hidden');
                calcularTotais();
                criarGraficoCategorias();
                criarGraficoSaldo();
                renderizarContas();
            }, 2000);
        });
    </script>
</body>
</html>
