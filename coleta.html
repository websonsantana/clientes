<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Fila de Retirada de Adubo</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-4xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-4">üì¶ Fila de Retirada de Adubo</h1>

    <!-- Configura√ß√£o Supabase -->
    <div class="bg-white p-4 rounded shadow mb-6">
      <h2 class="text-xl font-semibold mb-2">üîß Configura√ß√£o</h2>
      <input id="url" type="text" placeholder="URL do Projeto" class="input" value="https://hudsoncity-hxbpb.supabase.co" />
      <input id="key" type="text" placeholder="Chave P√∫blica (anon key)" class="input" value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJscmFvZGR1Y2NsdG55aHlrYmJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4MDU3MzUsImV4cCI6MjA3MzM4MTczNX0.GHr4rRurb1zzy6g2lirATxghtmgt7PGjEPzA_vKlzY0" />
      <input id="adminPassword" type="password" placeholder="Senha de Administrador" class="input" />
      <button onclick="configurar()" class="btn mt-2">Configurar</button>
    </div>

    <!-- √Årea p√∫blica e painel admin ser√£o inseridos aqui -->
    <div id="conteudo" class="hidden"></div>
  </div>

  <script>
    let supabase, senhaAdmin;

    function configurar() {
      const url = document.getElementById("url").value;
      const key = document.getElementById("key").value;
      senhaAdmin = document.getElementById("adminPassword").value;

      if (!url || !key || !senhaAdmin) {
        alert("Preencha todos os campos.");
        return;
      }

      supabase = supabase.createClient(url, key);
      document.getElementById("conteudo").classList.remove("hidden");
      carregarInterface();
    }

    function carregarInterface() {
      document.getElementById("conteudo").innerHTML = `
        <div class="bg-white p-4 rounded shadow mb-6">
          <h2 class="text-xl font-semibold mb-2">üìù Cadastro na Fila</h2>
          <input id="nome" type="text" placeholder="Nome" class="input" />
          <input id="email" type="email" placeholder="Email" class="input" />
          <input id="setor" type="text" placeholder="Setor" class="input" />
          <button onclick="cadastrar()" class="btn mt-2">Entrar na Fila</button>
        </div>

        <div class="bg-white p-4 rounded shadow">
          <h2 class="text-xl font-semibold mb-2">üìã Fila Atual</h2>
          <table class="table-auto w-full text-left">
            <thead>
              <tr class="bg-gray-200">
                <th class="px-2 py-1">Nome</th>
                <th class="px-2 py-1">Setor</th>
                <th class="px-2 py-1">Status</th>
                <th class="px-2 py-1">Agendamento</th>
              </tr>
            </thead>
            <tbody id="tabelaFila"></tbody>
          </table>
        </div>
      `;
      listarFila();
    }

    async function cadastrar() {
      const name = document.getElementById("nome").value;
      const email = document.getElementById("email").value;
      const sector = document.getElementById("setor").value;

      if (!name || !email || !sector) {
        alert("Preencha todos os campos.");
        return;
      }

      const { error } = await supabase.from("fertilizer_queue").insert({
        name, email, sector, status: "writing", created_at: new Date().toISOString()
      });

      if (error) {
        alert("Erro ao cadastrar: " + error.message);
      } else {
        alert("Cadastro realizado com sucesso!");
        listarFila();
      }
    }

    async function listarFila() {
      const { data, error } = await supabase.from("fertilizer_queue").select("*").order("created_at", { ascending: true });
      const tabela = document.getElementById("tabelaFila");
      tabela.innerHTML = "";

      if (error) {
        tabela.innerHTML = `<tr><td colspan="4">Erro ao carregar fila</td></tr>`;
        return;
      }

      data.forEach(item => {
        tabela.innerHTML += `
          <tr>
            <td class="px-2 py-1">${item.name}</td>
            <td class="px-2 py-1">${item.sector}</td>
            <td class="px-2 py-1">${item.status}</td>
            <td class="px-2 py-1">${item.scheduled_date || "-"} ${item.scheduled_time || ""}</td>
          </tr>
        `;
      });
    }
  </script>

  <style>
    .input { width: 100%; padding: 8px; margin-bottom: 8px; border: 1px solid #ccc; border-radius: 4px; }
    .btn { background: #2563eb; color: white; padding: 8px 16px; border-radius: 4px; }
    .btn:hover { background: #1d4ed8; }
  </style>
</body>
</html>
